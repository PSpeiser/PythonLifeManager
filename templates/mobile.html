<!DOCTYPE html>
<meta name="viewport" content="width=device-width, user-scalable=no">
<html>
<head>
    <title>Calorietracker</title>
    <script src="/static/jquery-1.10.2.js"></script>
    <script src="/static/jquery.dataTables.js"></script>
    <script src="/static/jquery.jstree.js"></script>
    <script src="/static/ui/jquery-ui.js"></script>
    <link rel="stylesheet" href="/static/themes/base/jquery-ui.css">
    <style>
        body {
            font: 12px sans-serif;
            background-color: #eaeaea;
        }

            /*
            ########    ###    ########  ##       ########     ######   ######   ######
               ##      ## ##   ##     ## ##       ##          ##    ## ##    ## ##    ##
               ##     ##   ##  ##     ## ##       ##          ##       ##       ##
               ##    ##     ## ########  ##       ######      ##        ######   ######
               ##    ######### ##     ## ##       ##          ##             ##       ##
               ##    ##     ## ##     ## ##       ##          ##    ## ##    ## ##    ##
               ##    ##     ## ########  ######## ########     ######   ######   ######
            */
        #table_wrapper {
            float: left;
            max-width: 260px;
            overflow: auto;
            margin: 2px;
            border: 1px ridge darkgray;
            padding: 5px;
        }

        #table_processing {
            height: 0px;
            padding: 0px;
            margin: 0px;
            visibility: hidden;
        }

        thead, th {
            border: 1px solid darkgray;
            border-collapse: collapse;
            border-spacing: 0.5rem;
        }

        td.css-button, a.css-button {
            /* Structure */
            zoom: 1;
            font-size: 100%;
            padding: 0.4em 1em 0.45em;
            line-height: normal;
            white-space: nowrap;
            vertical-align: baseline;
            text-align: center;
            cursor: pointer;

            /* Presentation */
            color: #444;
            color: rgba(0, 0, 0, 0.80);
            border: 1px solid #999;
            border: none rgba(0, 0, 0, 0);
            background-color: #E6E6E6;
            filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#80ffffff', endColorstr='#00ffffff', GradientType=0);
            background-image: -webkit-gradient(linear, 0 0, 0 100%, from(rgba(255, 255, 255, 0.30)), color-stop(40%, rgba(255, 255, 255, 0.15)), to(transparent));
            background-image: -webkit-linear-gradient(rgba(255, 255, 255, 0.30), rgba(255, 255, 255, 0.15) 40%, transparent);
            background-image: -moz-linear-gradient(top, rgba(255, 255, 255, 0.30), rgba(255, 255, 255, 0.15) 40%, transparent);
            background-image: -ms-linear-gradient(rgba(255, 255, 255, 0.30), rgba(255, 255, 255, 0.15) 40%, transparent);
            background-image: -o-linear-gradient(rgba(255, 255, 255, 0.30), rgba(255, 255, 255, 0.15) 40%, transparent);
            background-image: linear-gradient(rgba(255, 255, 255, 0.30), rgba(255, 255, 255, 0.15) 40%, transparent);
            text-decoration: none;
            -webkit-border-radius: 4px;
            -moz-border-radius: 4px;
            border-radius: 4px;
            -webkit-box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.25) inset, 0 2px 0 rgba(255, 255, 255, 0.30) inset, 0 1px 2px rgba(0, 0, 0, 0.15);
            -moz-box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.25) inset, 0 2px 0 rgba(255, 255, 255, 0.30) inset, 0 1px 2px rgba(0, 0, 0, 0.15);
            box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.25) inset, 0 2px 0 rgba(255, 255, 255, 0.30) inset, 0 1px 2px rgba(0, 0, 0, 0.15);
        }

        td {
            box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.25) inset, 0 2px 0 rgba(255, 255, 255, 0.30) inset, 0 1px 2px rgba(0, 0, 0, 0.15);
            text-align: center;
            padding: 0.4em 0.5em 0.45em;
        }

    </style>
</head>
<body>
<p>
    <a class="css-button" href="/admin" target="_blank">Admin</a>
    <a class="css-button" href="/admin/calorietracker/food/add" target="_blank">Add Food</a>
    <a class="css-button" href="/">Desktop</a>
</p>
<table id="table">
    <thead>
    <tr>
        <th>ID</th>
        <th>Name</th>
        <th>KCal</th>
    </tr>
    </thead>
    <tbody>
    </tbody>
</table>
<script>

    /*
     .########.....###....########....###....########....###....########..##.......########..######.
     .##.....##...##.##......##......##.##......##......##.##...##.....##.##.......##.......##....##
     .##.....##..##...##.....##.....##...##.....##.....##...##..##.....##.##.......##.......##......
     .##.....##.##.....##....##....##.....##....##....##.....##.########..##.......######....######.
     .##.....##.#########....##....#########....##....#########.##.....##.##.......##.............##
     .##.....##.##.....##....##....##.....##....##....##.....##.##.....##.##.......##.......##....##
     .########..##.....##....##....##.....##....##....##.....##.########..########.########..######.
     */
    $(document).ready(function () {
        oTable = $('#table').dataTable({
            bProcessing: true,
            sAjaxSource: 'food.json',
            "aoColumns": [
                /* ID */   { "bSearchable": false, "bVisible": false },
                /* Name */ {"sClass": "css-button"},
                /* KCal */ null
            ],
            bSort: false,
            "bFilter": false,
            "bInfo": false,
            bAutoWidth: false,
            sScrollX: 'auto',
            sScrollY: "447px",
            bScrollCollapse: true,
            bPaginate: false,
            fnDrawCallback: function () {
                clickRowHandler();
            }});
    });
    function clickRowHandler() {
        $('#table tbody td.css-button').bind('click', function () {
                    aData = oTable.fnGetData(this.parentElement);
                    var div = $('<div>', {id: 'dialog-confirm', title: 'Add Meal'})
                    $('body').append(div);
                    div.text('Add ' + aData[1] + ' ?').dialog({
                        resizable: false,
                        height: 130,
                        modal: true,
                        buttons: {
                            "Add meal": function () {
                                //send meal deletion here then reload json data sources
                                var food_id = aData[0];
                                //add meal here
                                $.post("add_meal", {
                                    food_id: food_id,
                                    csrfmiddlewaretoken: '{{ csrf_token }}'
                                }, function (data) {
                                    refreshElements();
                                })
                                $(this).dialog("close");
                            },
                            "Cancel": function () {
                                $(this).dialog("close");
                            }
                        }
                    });
                    div.parent().position({
                        my: 'center bottom+25',
                        at: 'center',
                        of: this.parentElement,
                        collision: 'fit'
                    });
                }
        );
    }
    ;
</script>
</body>
</html>